<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #e9ecef; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; }
        h2 { text-align: center; color: #0056b3; margin-top: 10px; margin-bottom: 5px; }
        .total-responses { text-align: center; font-size: 1rem; color: #666; margin-bottom: 20px; }
        .loading { text-align: center; color: #007bff; font-weight: 500; margin: 30px 0; }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-title { font-size: 1.1rem; font-weight: 500; margin-bottom: 15px; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; }
        
        /* ‡∏à‡∏±‡∏î Layout ‡∏Å‡∏£‡∏≤‡∏ü 2 ‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        .charts-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media(min-width: 768px) { .charts-grid { grid-template-columns: 2fr 1fr; } }
        
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå */
        .comments-box { max-height: 250px; overflow-y: auto; padding-right: 10px; }
        .comment-item { background: #f8f9fa; padding: 12px 15px; border-radius: 8px; margin-bottom: 10px; font-size: 0.95rem; border-left: 4px solid #17a2b8; }
        .comment-item.empty { border-left: 4px solid #ced4da; color: #6c757d; font-style: italic; }
        
        /* ‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
        .comments-box::-webkit-scrollbar { width: 6px; }
        .comments-box::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</h2>
        <div class="total-responses" id="totalCount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°: 0 ‡∏Ñ‡∏ô</div>
        
        <div id="loadingStatus" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‚è≥</div>
        
        <div id="dashboardContent" style="display: none;">
            
            <div class="charts-grid">
                <div class="card">
                    <div class="card-title">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡πÄ‡∏ï‡πá‡∏° 5)</div>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div class="chart-container">
                        <canvas id="doughnutChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üí¨ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>
                <div class="comments-box" id="feedbackBox">
                    </div>
            </div>

            <div class="card">
                <div class="card-title">üìå ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏á‡∏≤‡∏ô ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ</div>
                <div class="comments-box" id="recommendBox">
                    </div>
            </div>

        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyk7veuNEPJymxJjIjIoJfKifcgEcpzIj5TlQHrY_nJ_XfRfNeiWLOs7cjT1J9CJtJu/exec';

        fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
                document.getElementById('loadingStatus').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                document.getElementById('totalCount').innerText = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°: ${data.length} ‡∏Ñ‡∏ô`;

                if(data.length === 0) return;

                // --- 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢) ---
                let sum = { q1: 0, q2: 0, q3: 0, q4: 0, q5: 0 };
                let suitableCount = 0;
                let notSuitableCount = 0;

                data.forEach(row => {
                    sum.q1 += Number(row.q1) || 0;
                    sum.q2 += Number(row.q2) || 0;
                    sum.q3 += Number(row.q3) || 0;
                    sum.q4 += Number(row.q4) || 0;
                    sum.q5 += Number(row.q5) || 0;

                    // ‡∏ô‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≠ 6
                    if(row.q6 === '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') suitableCount++;
                    else if(row.q6 === '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°') notSuitableCount++;
                });

                let count = data.length;
                let averages = [
                    (sum.q1 / count).toFixed(2), (sum.q2 / count).toFixed(2),
                    (sum.q3 / count).toFixed(2), (sum.q4 / count).toFixed(2),
                    (sum.q5 / count).toFixed(2)
                ];

                // --- 2. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á ---
                new Chart(document.getElementById('barChart'), {
                    type: 'bar',
                    data: {
                        labels: ['‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà', '‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°'],
                        datasets: [{
                            label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
                            data: averages,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)',
                            borderRadius: 4
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 5 } }, plugins: { legend: { display: false } } }
                });

                // --- 3. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÇ‡∏î‡∏ô‡∏±‡∏ó ---
                new Chart(document.getElementById('doughnutChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°', '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°'],
                        datasets: [{
                            data: [suitableCount, notSuitableCount],
                            backgroundColor: ['#28a745', '#dc3545']
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                // --- 4. ‡∏î‡∏∂‡∏á‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á ---
                const feedbackBox = document.getElementById('feedbackBox');
                const recommendBox = document.getElementById('recommendBox');

                data.forEach(row => {
                    // ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏Ç‡πâ‡∏≠ 7
                    if(row.q7 && row.q7.trim() !== "") {
                        let div = document.createElement('div');
                        div.className = 'comment-item';
                        div.innerText = row.q7;
                        feedbackBox.appendChild(div);
                    }
                    
                    // ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏Ç‡πâ‡∏≠ 8
                    if(row.q8 && row.q8.trim() !== "") {
                        let div = document.createElement('div');
                        div.className = 'comment-item';
                        div.innerText = row.q8;
                        recommendBox.appendChild(div);
                    }
                });

                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÄ‡∏•‡∏¢
                if(feedbackBox.innerHTML === "") feedbackBox.innerHTML = '<div class="comment-item empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</div>';
                if(recommendBox.innerHTML === "") recommendBox.innerHTML = '<div class="comment-item empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡πâ‡∏≤‡∏ô</div>';

            })
            .catch(error => {
                document.getElementById('loadingStatus').innerText = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                console.error('Error:', error);
            });
    </script>
</body>
</html>